# What is Lucid Geometry?

While pure geometry speaks in the language of perfection, its voice can feel distant. Here, we coax a more organic, lucid flow from its rigid forms. This application is a digital canvas where simple rules blossom into surprising and intricate beauty.

# Inspiration

We all had [Spirograph](https://www.playmonster.com/brands/spirograph/) as children. I still have mine. It's magic that rigid gears, wheels, holes, and a pen can create such beautiful shapes. Organic shapes. Spirograph makes the discrete—numbers, lengths, sizes, angles—into something continuous and flowing.

Lucid Geometry is a modern, three-dimensional evolution of that idea. Instead of gears and pens, we use vectors and matrices. Instead of a flat piece of paper, we have an infinite digital space. The core principle remains the same: create complexity and beauty from a simple set of instructions.

---

# Help 

## Main Controls

- **Add Segment**: Adds a new drawing segment to the end of the list.
- **Randomize**: Generates a new set of random segments based on the configuration in the "Randomizer Settings" panel.
- **Share**: Copies a unique URL to your clipboard that contains your current creation's configuration.
- **Fullscreen**: Toggles a fullscreen view of the 3D canvas.

## 3D Viewport

- **Rotate**: Left-click and drag.
- **Pan**: Right-click and drag.
- **Zoom**: Scroll with your mouse wheel or trackpad.

## Scene Settings

- **Gentle Rotation**: Toggles a slow, continuous rotation of the entire scene.
- **Environment**: Choose from a variety of High-Dynamic Range Image (HDRI) backgrounds that provide realistic lighting and reflections.
- **Material**: Change the surface properties of your geometric shape (e.g., Gold, Silver, Glass).

## Segment Editor

Each row represents a single drawing operation. You can add as many segments as you like. The operations are performed in order from top to bottom.

- **Length**: The distance to move after rotating. Can be positive or negative.
- **Ratio**: The speed of rotation for this segment, expressed as a fraction (numerator/denominator).
- **Axis**: The axis (X, Y, or Z) around which to rotate.

---

# Technology and Mechanism

The intricate shapes in Lucid Geometry are generated by a series of matrix transformations applied sequentially. Each "segment" you define corresponds to a rotation followed by a translation in 3D space.

## The Core Concept

Imagine a drawing pen at the center of our 3D world (the origin). For each segment, we perform two actions:

1.  **Rotate**: We rotate the entire coordinate system by a certain angle around a specific axis (X, Y, or Z).
2.  **Translate**: We move the pen forward along the *new* X-axis by the segment's `length`.

The final position of the pen after these two steps becomes the starting point for the next segment. We trace the path of the pen over time to create the final, continuous shape.

In the Spirograph analogy, each 'segment' represents a wheel. The `length` of the segment is analogous to the size of the wheel, determining how far the drawing point moves. The `ratio` defines the rotational speed, just as the number of teeth on a Spirograph gear would dictate its relationship to the other gears.

## The Math Behind the Magic

The process is calculated for thousands of small time steps (`t`) to generate a smooth curve. For any given time `t`, the position of the pen is determined by the following:

**1. Angular Speed** For each segment, the speed of rotation is the ratio you provide:

$$s = \frac{numerator}{denominator}$$

**2. Angle of Rotation** The angle of rotation ($\theta$) at time `t` is simply the speed multiplied by time:

$$\theta(t) = t \cdot s$$

**3. Matrix Transformations** Each operation is represented by a 4x4 transformation matrix. For a single segment `i`, we have a rotation matrix $R_i$ and a translation matrix $T_i$.

-   **Rotation $R_i(\theta_i(t))$**: A standard 3D rotation matrix for the segment's axis (X, Y, or Z) and angle $\theta_i(t))$.
-   **Translation $T_i(l_i)$**: A translation matrix that moves the point along the X-axis by the segment's length $l_i$.

The combined transformation for one segment is $R_i \cdot T_i$.

**4. The Final Position** To find the final position of the pen at time `t`, we multiply the transformation matrices of all segments together in sequence. For `n` segments, the final transformation matrix `M(t)` is:

$$M(t) = (R_1 \cdot T_1) \cdot (R_2 \cdot T_2) \cdot \ldots \cdot (R_n \cdot T_n)$$

The final point $P(t)$ is the result of applying this combined matrix to a point at the origin.

**5. Creating a Closed Loop** To ensure the shape connects back to its starting point, we must find a `totalTime` where all rotations complete a full cycle simultaneously. This is achieved by calculating the Least Common Multiple (LCM) of the denominators of all speed ratios. The `totalTime` is then $2 \cdot \pi \cdot LCM$, which guarantees a seamless, closed loop.

---

# Three.js Integration

The entire 3D visualization is powered by [Three.js](https://threejs.org/), a powerful and intuitive JavaScript library for creating and displaying 3D computer graphics in a web browser.

Here's how Lucid Geometry uses it:

1.  **Scene, Camera, and Renderer**: We start by setting up the fundamental components: a `Scene` to hold all our objects, a `PerspectiveCamera` to view them, and a `WebGLRenderer` to draw the scene onto the HTML canvas.

2.  **Generating the Geometry**: The array of `Vector3` points calculated from the segments is used to create a custom path. This path is then fed into `TubeGeometry`, which generates a smooth, continuous tube shape that follows the path precisely.

3.  **Advanced Materials**: The application uses `MeshPhysicalMaterial`, a physically-based rendering (PBR) material. This allows for realistic surfaces with advanced properties like `metalness`, `roughness`, and `transmission` (for glass-like effects).

4.  **Environment Lighting**: The beautiful and realistic lighting is achieved using High-Dynamic Range Images (HDRIs). We use the `RGBELoader` to load `.hdr` files, which wrap the entire scene in a 360-degree image. This image provides both the background and the light sources that reflect off the geometry's surface.

5.  **Interactive Controls**: The intuitive camera controls (rotate, pan, zoom) are provided by the `OrbitControls` utility, which makes navigating the 3D space a breeze.
